import{g as ve,a as ge,b as _e,c as he,u as ke,d as ye,e as be}from"./index-Cpqr1tGl.js";import{h as Ce}from"./confirm-CxKUQBJO.js";import{u as S,a as xe,d as Ve}from"./notification-DhcrVVnz.js";import{g as K}from"./index-B7ISXk8i.js";import{h as s,i as q,H as Ie,r,o as A,c as E,b as p,a as t,w as a,e as d,t as j,F as H,k as Pe,C as we,B as O,S as G,U as ze,M as Se}from"./index-C5uf1WvN.js";const Ae={class:"content-box"},Me={class:"search-box"},Ue={class:"operation-box"},Ne={class:"pagination-box"},Re={class:"dialog-footer"},Be={style:{flex:"auto"}},Te={style:{flex:"auto"}},Ee={__name:"index",setup(De){let b;const M=s([]),m=q({pageNum:1,pageSize:10,name:void 0,roleId:void 0,status:void 0});function J(){m.name=void 0}const Q={children:"children",label:"title"},_=s(!1),I=s(""),c=q({id:void 0,name:void 0,createBy:void 0,createTime:void 0,updateBy:void 0,updateTime:void 0}),U=s(0),P=s([]);async function W(n){P.value=n}async function h(){const n=await ve(m);n.code===200&&(M.value=n.data,U.value=Number(n.total))}function N(n){Ce(async()=>{const e=await be(n);Ve(e,()=>{h()})})}function X(n){N([n.id])}function Y(){P.value.length>0?N(P.value.map(n=>n.id)):O.error("请选择要删除的数据")}function Z(n){m.pageNum=1,h()}function ee(n){h()}function R(){c.id=void 0,c.name=void 0}function ne(){R(),_.value=!0,I.value="新增角色"}async function te(n){R(),_.value=!0,I.value="编辑角色";const e=await ge(n.id);Object.assign(c,e.data)}const k=s(!1),y=s(!1),C=s(""),B=s("rtl"),T=s([]),x=s([]),u=s([]),D=s([]),w=s(null);let V;async function ae(n){y.value=!0,C.value="分配菜单",b=n.id;const e=await G({pageSize:500});if(e.code===200){const{arr:f,map:v}=ze(e.data);D.value=f,V=v}const i=await G({pageSize:500,roleId:n.id==1?void 0:n.id});if(e.code===200){const v=i.data.map(g=>g.id);u.value=v,console.log(u.value),w.value.setCheckedKeys(u.value),await Se()}}async function le(n){b=n.id,k.value=!0,C.value="分配权限";const e=await K({pageSize:500});e.code===200&&(T.value=e.data);const i=await K({pageSize:500,roleId:n.id==1?void 0:n.id});if(e.code===200){const f=i.data;x.value=f.map(v=>v.id)}}async function oe(){let n={roleId:b,permissionIds:x.value};const e=await _e(n);S(e,()=>{k.value=!1})}async function ie(){let n={roleId:b,menuIds:u.value};const e=await he(n);S(e,()=>{y.value=!1})}async function se(){if(c.name&&c.name.trim())if(c.id){const n=await ke(c);S(n,()=>{h(),_.value=!1})}else{const n=await ye(c);xe(n,()=>{h(),_.value=!1})}else O.error("请输入角色名")}function $(n){if(n.parentId==="0")return;const e=V.get(n.parentId);u.value.find(f=>f===e.id)||(u.value.push(e.id),$(e))}function L(n){const e=V.get(n.id);if(e.children&&e.children.length>0){u.value=u.value.filter(i=>{const f=V.get(i);return i!==e.id&&f.parentId!==e.id});for(let i=0;i<e.children.length;i++)L(e.children[i])}}async function de(n,e){e.checkedKeys.length>u.value.length?($(n),u.value.push(n.id)):n.children?L(n):u.value=e.checkedKeys,w.value.setCheckedKeys(u.value)}return Ie(()=>{h()}),(n,e)=>{const i=r("el-input"),f=r("el-form-item"),v=r("el-form"),o=r("el-button"),g=r("el-table-column"),ue=r("el-table"),re=r("el-pagination"),ce=r("el-dialog"),fe=r("el-checkbox"),pe=r("el-checkbox-group"),F=r("el-drawer"),me=r("el-tree");return A(),E(H,null,[p("div",Ae,[p("div",Me,[t(v,{inline:""},{default:a(()=>[t(f,{label:"角色"},{default:a(()=>[t(i,{modelValue:m.name,"onUpdate:modelValue":e[0]||(e[0]=l=>m.name=l),placeholder:"请输入角色名"},null,8,["modelValue"])]),_:1})]),_:1})]),p("div",Ue,[t(o,{icon:"Search",onClick:h},{default:a(()=>[d("查询")]),_:1}),t(o,{type:"info",icon:"Refresh",onClick:J},{default:a(()=>[d("重置")]),_:1}),t(o,{type:"primary",icon:"Plus",onClick:ne},{default:a(()=>[d("新增")]),_:1}),t(o,{type:"danger",icon:"Delete",onClick:Y},{default:a(()=>[d("批量删除")]),_:1})]),t(ue,{data:M.value,onSelectionChange:W},{default:a(()=>[t(g,{type:"selection",width:"55"}),t(g,{label:"用户名",type:"index",width:"80"}),t(g,{label:"角色名",prop:"name"}),t(g,{prop:"createBy",label:"创建人"}),t(g,{prop:"createTime",label:"创建时间"}),t(g,{label:"操作"},{default:a(({row:l})=>[t(o,{type:"text",icon:"Menu",onClick:z=>ae(l)},{default:a(()=>[d("分配菜单")]),_:2},1032,["onClick"]),t(o,{type:"text",icon:"UserFilled",onClick:z=>le(l)},{default:a(()=>[d("分配权限")]),_:2},1032,["onClick"]),t(o,{type:"text",icon:"Edit",onClick:z=>te(l)},{default:a(()=>[d("编辑")]),_:2},1032,["onClick"]),t(o,{type:"text",icon:"Delete",onClick:z=>X(l)},{default:a(()=>[d("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),p("div",Ne,[t(re,{"current-page":m.pageNum,"onUpdate:currentPage":e[1]||(e[1]=l=>m.pageNum=l),"page-size":m.pageSize,"onUpdate:pageSize":e[2]||(e[2]=l=>m.pageSize=l),"page-sizes":[10,20,50,100],layout:"prev, pager, next,jumper,->, sizes,total",total:U.value,background:"",onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])]),t(ce,{modelValue:_.value,"onUpdate:modelValue":e[5]||(e[5]=l=>_.value=l),title:I.value},{footer:a(()=>[p("span",Re,[t(o,{onClick:e[4]||(e[4]=l=>_.value=!1)},{default:a(()=>[d("取 消")]),_:1}),t(o,{type:"primary",onClick:se},{default:a(()=>[d("确 定")]),_:1})])]),default:a(()=>[t(v,{model:c,"label-width":"80px"},{default:a(()=>[t(f,{label:"角色名",required:""},{default:a(()=>[t(i,{modelValue:c.name,"onUpdate:modelValue":e[3]||(e[3]=l=>c.name=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),t(F,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=l=>k.value=l),direction:B.value},{header:a(()=>[p("h4",null,j(C.value),1)]),default:a(()=>[p("div",null,[t(pe,{modelValue:x.value,"onUpdate:modelValue":e[6]||(e[6]=l=>x.value=l),size:"large"},{default:a(()=>[(A(!0),E(H,null,Pe(T.value,l=>(A(),we(fe,{value:l.id,label:l.description,size:"large",border:"",key:l.id},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),footer:a(()=>[p("div",Be,[t(o,{onClick:e[7]||(e[7]=l=>k.value=!1)},{default:a(()=>[d("cancel")]),_:1}),t(o,{type:"primary",onClick:oe},{default:a(()=>[d("confirm")]),_:1})])]),_:1},8,["modelValue","direction"]),t(F,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),direction:B.value},{header:a(()=>[p("h4",null,j(C.value),1)]),default:a(()=>[p("div",null,[t(me,{style:{"max-width":"600px"},data:D.value,props:Q,ref_key:"menuTree",ref:w,"node-key":"id","show-checkbox":"","check-strictly":"",onCheck:de,"highlight-current":""},null,8,["data"])])]),footer:a(()=>[p("div",Te,[t(o,{onClick:e[9]||(e[9]=l=>y.value=!1)},{default:a(()=>[d("cancel")]),_:1}),t(o,{type:"primary",onClick:ie},{default:a(()=>[d("confirm")]),_:1})])]),_:1},8,["modelValue","direction"])],64)}}};export{Ee as default};
